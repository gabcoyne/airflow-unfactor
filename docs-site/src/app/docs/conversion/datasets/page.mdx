# Datasets â†’ Prefect Events

Convert Airflow Dataset/Asset dependencies into Prefect-friendly outputs.

## What We Detect

- `Dataset("...")` and `Asset("...")` definitions
- `@task(outlets=[...])` producers
- `@dag(schedule=[...])` consumers

## What We Generate

- `producer_code`: `emit_event(...)` helper functions for produced datasets/assets
- `deployment_yaml`: trigger stanzas for consumer DAGs
- `events`: normalized event names (for example, `dataset.s3.my_bucket.data`)
- `assets`: detected Airflow assets with metadata (`name`, `uri`, `event_name`, `line_number`)
- `materialization_code`: asset materialization scaffold when assets are detected

## Mapping Summary

| Airflow pattern | Generated output |
|---|---|
| `Dataset("s3://bucket/data.csv")` | Event base: `dataset.s3.bucket.data` |
| `Asset("s3://bucket/data.csv")` | Event base + materialization scaffold |
| `@task(outlets=[dataset_or_asset])` | `emit_event(..., resource={"prefect.resource.id": ...})` helper |
| `@dag(schedule=[dataset_or_asset])` | Deployment trigger in `deployment_yaml` |

## Behavior Delta: Datasets vs Assets

- Both Datasets and Assets are converted into event-based automation outputs.
- Assets additionally produce `materialization_code`.
- `materialization_code` is intentionally a scaffold and must be finalized for your Prefect runtime.

## Manual Follow-Up Required

- Replace materialization placeholders with your concrete Prefect asset implementation.
- Finalize naming/ownership/lineage conventions for assets.
- Validate trigger patterns in `deployment_yaml` against your deployment topology.

## Example

Airflow input:

```python
from airflow.assets import Asset
from airflow.decorators import task

sales_asset = Asset("s3://sales/daily")

@task(outlets=[sales_asset])
def build_sales():
    ...
```

Generated output (simplified):

```python
from prefect.events import emit_event

def emit_sales_asset_updated():
    emit_event(
        event="dataset.s3.sales.daily.updated",
        resource={"prefect.resource.id": "s3://sales/daily"},
    )
```

```python
from prefect.assets import materialize

@materialize("s3://sales/daily")
def materialize_sales_asset() -> str:
    # TODO: replace with concrete Prefect asset API usage
    return "s3://sales/daily"
```
