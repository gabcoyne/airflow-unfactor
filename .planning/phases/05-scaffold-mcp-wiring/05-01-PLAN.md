---
phase: 05-scaffold-mcp-wiring
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/airflow_unfactor/server.py
  - tests/test_server_scaffold.py
autonomous: true
requirements:
  - KNOW-12

must_haves:
  truths:
    - "MCP scaffold() wrapper accepts schedule_interval parameter"
    - "MCP scaffold() forwards schedule_interval to scaffold_project()"
    - "Calling scaffold with schedule_interval='0 6 * * *' produces prefect.yaml with cron config"
    - "Calling scaffold without schedule_interval produces identical output to before (no regression)"
    - "All existing tests pass without modification"
  artifacts:
    - path: "src/airflow_unfactor/server.py"
      provides: "schedule_interval parameter in scaffold MCP wrapper"
      contains: "schedule_interval"
    - path: "tests/test_server_scaffold.py"
      provides: "MCP-level scaffold schedule forwarding test"
      contains: "schedule_interval"
  key_links:
    - from: "src/airflow_unfactor/server.py"
      to: "src/airflow_unfactor/tools/scaffold.py"
      via: "scaffold() calls scaffold_project(schedule_interval=schedule_interval)"
      pattern: "scaffold_project"
    - from: "tests/test_server_scaffold.py"
      to: "src/airflow_unfactor/server.py"
      via: "Tests call the MCP scaffold wrapper directly"
      pattern: "scaffold"
---

<objective>
Wire the `schedule_interval` parameter through the MCP `scaffold()` wrapper in server.py to close the KNOW-12 gap.

Purpose: The `scaffold_project()` function in `tools/scaffold.py` already accepts `schedule_interval` and generates correct schedule YAML (17 tests pass). However, the MCP tool wrapper `scaffold()` in `server.py` does not expose or forward this parameter, so LLMs calling the MCP tool cannot trigger schedule-aware scaffolding. This is a two-line fix plus one test file.

Output: Updated server.py with schedule_interval forwarded, plus a new MCP-level test file proving the parameter flows through.
</objective>

<execution_context>
@/Users/gcoyne/.claude/get-shit-done/workflows/execute-plan.md
@/Users/gcoyne/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@src/airflow_unfactor/server.py (MCP tool wrappers — scaffold() at lines 124-154)
@src/airflow_unfactor/tools/scaffold.py (scaffold_project function with schedule_interval)
@tests/test_scaffold.py (existing schedule tests — confirms implementation works)
</context>

<tasks>

<task id="1" type="auto">
  <files>
    src/airflow_unfactor/server.py
  </files>
  <action>
    Modify the `scaffold()` MCP wrapper function in server.py (lines 124-154):

    1. Add `schedule_interval: str | None = None` parameter to the `scaffold()` function signature, after `include_github_actions`. Add docstring entry: `schedule_interval: Cron string, preset (@daily etc.), seconds, or None.`

    2. Pass `schedule_interval=schedule_interval` in the `scaffold_project()` call at line 149. The call currently passes `output_directory`, `project_name`, `include_docker`, `include_github_actions` — add `schedule_interval` as the fifth keyword argument.

    That is the complete code change. Two lines modified in one file.
  </action>
  <verify>
    <automated>cd /Users/gcoyne/src/prefect/airflow-unfactor && uv run pytest tests/test_scaffold.py -x -q</automated>
  </verify>
  <done>
    - scaffold() signature includes schedule_interval: str | None = None
    - scaffold_project() call includes schedule_interval=schedule_interval
    - All 17 existing schedule tests still pass
  </done>
</task>

<task id="2" type="auto">
  <files>
    tests/test_server_scaffold.py
  </files>
  <action>
    Create `tests/test_server_scaffold.py` with an MCP-level test class that imports and calls the `scaffold` function from `airflow_unfactor.server` (the MCP wrapper, not the underlying `scaffold_project`).

    Tests to include:

    1. `test_mcp_scaffold_forwards_schedule_interval` — Call `scaffold(output_directory=str(tmp_path), schedule_interval="0 6 * * *")` via `asyncio.run()`. Parse the JSON result. Read the generated `prefect.yaml` and assert it contains `cron: "0 6 * * *"` (not commented out).

    2. `test_mcp_scaffold_without_schedule_no_regression` — Call `scaffold(output_directory=str(tmp_path))` (no schedule_interval). Parse the JSON result. Read `prefect.yaml` and assert it contains the commented-out example with `[]` (same as before).

    3. `test_mcp_scaffold_schedule_in_report` — Call `scaffold(output_directory=str(tmp_path), schedule_interval="@daily")`. Parse JSON result and assert `result["schedule"] == "@daily"` (confirming schedule flows through to the report).

    Import pattern: `from airflow_unfactor.server import scaffold` — this imports the MCP-decorated wrapper. Use `asyncio.run()` to call it since it is async.
  </action>
  <verify>
    <automated>cd /Users/gcoyne/src/prefect/airflow-unfactor && uv run pytest tests/test_server_scaffold.py -x -v</automated>
  </verify>
  <done>
    - Three MCP-level tests exist and pass
    - Tests prove schedule_interval flows from MCP wrapper through to scaffold_project and into prefect.yaml output
  </done>
</task>

</tasks>

<verification>
After both tasks complete, run the full test suite to confirm no regressions:

```bash
cd /Users/gcoyne/src/prefect/airflow-unfactor && uv run pytest -x -q
```

Expected: All existing 144 tests pass plus 3 new tests = 147 total, zero failures.

Then verify KNOW-12 is fully satisfied:
- The MCP `scaffold` tool accepts `schedule_interval`
- The parameter flows through to `scaffold_project()`
- Generated `prefect.yaml` contains real schedule config
- No regression when `schedule_interval` is omitted
</verification>
