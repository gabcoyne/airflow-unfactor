# External Integrations

**Analysis Date:** 2026-02-26

## APIs & External Services

**GitHub (via Colin):**
- Service: Apache Airflow source code repository
- What it's used for: Fetching operator implementations and API definitions for translation knowledge compilation
- SDK/Client: `httpx` or raw GitHub API
- Auth: GitHub token via environment variable `GITHUB_TOKEN`
- Configuration: `colin.toml` defines `[[providers.github]]` with repo=apache/airflow

**Prefect MCP Server:**
- Service: Real-time Prefect documentation and concepts
- What it's used for: Live search for Prefect API documentation when translation knowledge gaps exist
- SDK/Client: FastMCP `Client` class (async HTTP transport)
- Configuration: Environment variables `MCP_PREFECT_ENABLED`, `MCP_PREFECT_URL`
- Default URL: `https://docs.prefect.io/mcp`
- Error handling: Falls back to Colin-compiled knowledge if unavailable
- Implementation: `src/airflow_unfactor/external_mcp.py`

**Anthropic Claude API (via Colin):**
- Service: LLM for knowledge compilation
- What it's used for: Summarizing Airflow operator source code into structured translation rules
- Model: `anthropic:claude-sonnet-4-5`
- Configuration: `colin.toml` defines `[[providers.llm]]`
- How used: Colin run-time only, not MCP server runtime

## Knowledge & Data Storage

**Local JSON Files (Colin Output):**
- Location: `colin/output/` directory
- Format: JSON with concept entries (operators, patterns, connections)
- Purpose: Compiled Airflow→Prefect translation knowledge
- Generated by: Colin build process (`colin run` or `colin/build.py`)
- Accessed by: `src/airflow_unfactor/knowledge.py` at MCP runtime
- Fallback: Built-in `FALLBACK_KNOWLEDGE` dict in `knowledge.py` if Colin output unavailable

**File Storage:**
- Type: Local filesystem only
- Use: Reading DAG files for analysis
- Tool: `read_dag` tool in `src/airflow_unfactor/tools/read_dag.py`
- Patterns: Accepts file paths or inline content

**Caching:**
- None detected - all operations are stateless
- Colin output JSON files act as a cache of compiled knowledge

## Knowledge Compilation Pipeline (Build-Time)

**Colin Project:**
- Location: `colin/` subdirectory
- Configuration: `colin.toml`
- Providers:
  1. **GitHub**: Fetches Apache Airflow operator source from `apache/airflow` repo
  2. **MCP**: Queries Prefect documentation via `https://docs.prefect.io/mcp`
  3. **LLM**: Uses Claude Sonnet 4.5 to summarize and generate translation rules

**Build Output:**
- Generates JSON files in `colin/output/`
- Files indexed by concept name (operators, patterns, connections)
- Example concepts: `PythonOperator`, `BashOperator`, `XCom`, `TaskGroup`, `DAG`

**Manual Build Script:**
- Location: `colin/build.py`
- Function: Interim build script that parses Markdown model templates into JSON
- Parses `{% section %}` blocks from `colin/models/` directory
- Outputs structured JSON files matching colin-py CLI output format

## Authentication & Identity

**Auth Provider:**
- Type: Environment-based secrets
- Method: No built-in auth — relies on environment variables for external services
- Secrets configuration:
  - `GITHUB_TOKEN` - For Colin's GitHub API access
  - `MCP_PREFECT_ENABLED` - Feature flag for Prefect docs search

**Note:** MCP server itself runs as stdio service, no user authentication

## Monitoring & Observability

**Error Tracking:**
- Not detected - no external error tracking service integrated

**Logs:**
- console/stdout (implicit via print statements)
- Error messages returned as JSON in tool outputs
- Test output via pytest (runs with `-v` flag by default)

**Code Quality:**
- Ruff (linting and formatting)
- Pyright (static type checking via pre-commit)
- pytest with coverage measurement

## CI/CD & Deployment

**Hosting:**
- GitHub Actions - CI pipeline
- Workflow: `.github/workflows/test.yml` (referenced in README badge)

**CI Pipeline:**
- Runs tests on push/PR
- Configured via GitHub Actions

**Package Distribution:**
- PyPI - Published as `airflow-unfactor`
- Install methods:
  - `uv pip install airflow-unfactor`
  - `pip install airflow-unfactor`
  - `pip install airflow-unfactor[ui]` (optional UI dependencies)

**MCP Distribution:**
- Distributed as Python package
- Used via MCP client configuration in Claude Desktop, Cursor, etc.
- Entry point: `uvx airflow-unfactor` or local MCP config

## Environment Configuration

**Required Environment Variables:**
- None mandatory at runtime for basic operation

**Optional Environment Variables:**
- `MCP_PREFECT_ENABLED` - Enable/disable Prefect MCP search (default: "true")
- `MCP_PREFECT_URL` - Prefect MCP server URL (default: "https://docs.prefect.io/mcp")
- `GITHUB_TOKEN` - GitHub API token (only needed for `colin run`)

**Secrets Location:**
- Environment variables (via shell/IDE/MCP client configuration)
- No `.env` file support detected in code

## Webhooks & Callbacks

**Incoming Webhooks:**
- Not detected - MCP server is request-response only via stdio

**Outgoing Webhooks:**
- None - Server does not initiate outbound connections except to:
  - Prefect MCP server (on-demand via `search_prefect_docs` tool)
  - GitHub API (during Colin compilation, not MCP runtime)

## Optional UI Integration (Not Core)

**When installed with `[ui]` extra:**
- Optional visual wizard at http://localhost:8765
- Provides: DAG analysis, conversion preview, validation, project export
- Implementation details not in core `pyproject.toml` (likely in separate UI package/feature)

## Cross-Service Coordination

**MCP Protocol:**
- All tools communicate via MCP standard protocol
- Client: FastMCP `Client` class for external MCP calls
- Transport: HTTP (Streamable transport for Prefect docs search)

**Fallback Strategy:**
- `lookup_concept` tool falls back to built-in knowledge if Colin output or MCP unavailable
- `search_prefect_docs` returns error suggestion to run `colin run` if Prefect MCP unreachable
- `read_dag` accepts both file paths and inline content

---

*Integration audit: 2026-02-26*
